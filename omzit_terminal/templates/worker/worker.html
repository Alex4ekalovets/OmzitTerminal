{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Терминал РЦ {{ ws_number }}</title>
    </head>
    <body>
        <h1>Терминал РЦ {{ ws_number }}</h1>
        <br />
        {% if initial_shift_tasks %}
        <table border="1" title="График цехов" align="center">
            <tr align="center">
                <td>№</td>
                <td>РЦ</td>
                <td>Изделие</td>
                <td>Заказ</td>
                <td>Номер операции</td>
                <td>Операция</td>
                <td>Трудоемкость</td>
                <td>Исполнители</td>
                <td>Статус</td>
                <td>Время начала работы</td>
                <td>Время приемки</td>
            </tr>
            {% for line in initial_shift_tasks %}
            <tr id="row" class="row" align="center">
                {% for el in line.values %}
                <td class="cell">{{ el }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>Распределённые сменные задания на РЦ {{ ws_number }} отсутствуют.</p>
        {% endif %}
        <!-- prettier-ignore -->
        {% if initial_shift_tasks %} 
        {% endif %}
        <script src="{% static 'worker/js/worker.js' %}"></script>
        <br /><br /><br />
        {% if select_shift_task %}
        <form action="{{ ws_number }}" method="POST" enctype="multipart/form-data" id="sel_1">
            {% csrf_token %}
            <label id="sel_2"> Выбор сменного задания для запуска в работу: </label>
            <br />
            <select multiple id="sel_3" size="10" name="task_id">
                <option selected id="0">Выберите сменное задание</option>
                {% for task in select_shift_task %}
                <option id="{{ task.id }}" data-send="{{ task.op_number }}--{{ task.model_name }}--{{ task.id }}">
                    <!-- prettier-ignore -->
                    {{ task.st_status }}--{{ task.id }}--{{ task.op_number }}--{{ task.model_name }}--{{ task.op_name_full }}--
                </option>
                {% endfor %}
            </select>
            <br />
            <button type="submit">Начать работу</button>
        </form>
        {% endif %}
        <script>
            // перенаправление на страницу чертежей
            // элемент select
            const select_element = document.getElementById("sel_3");
            document.addEventListener("keydown", function (event) {
                const ws_number = "{{ ws_number }}";
                // id выбранного option
                const st_id = select_element.options[select_element.selectedIndex].id;
                const tech_data = select_element.options[select_element.selectedIndex].dataset.send;
                //const op_number = select_element.options[select_element.selectedIndex].op_number;
                // кнопка выбрать чертёж
                if (event.code == "KeyV") {
                    if (st_id != "0") {
                        const draw_link = `/worker/${ws_number}--${tech_data}`; // ссылка на страницу с чертежем
                        location.href = draw_link; // переход по ссылке
                    }
                    // кнопка выхов мастера
                } else if (event.code == "Semicolon") {
                    // Вызов мастера
                    master_call_link = `/worker/${ws_number}-${st_id}/get`;
                    location.href = master_call_link;
                }
            });
        </script>
        <script src="{% static 'worker/js/listener.js' %}">
            //запуск меню выбора
        </script>
        <script>
            // сообщение о выполненном действии
            showNotification({
                top: 1000,
                right: 1000,
                html: "<p> {{ alert }} </p>",
            });
        </script>
        <br />
        <a href="{% url 'worker_choose' %}">Назад</a> <br />
    </body>
</html>
